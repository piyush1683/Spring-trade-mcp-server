<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade MCP Client</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sockjs-client/1.5.1/sockjs.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/stomp.js/2.3.3/stomp.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .button:hover {
            background: #0056b3;
        }
        .input-group {
            margin: 10px 0;
        }
        .input-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .input-group input, .input-group textarea {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .output {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin-top: 10px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.connected {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.disconnected {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <h1>Trade MCP Client</h1>
    
    <div class="status" id="connectionStatus">Disconnected</div>
    
    <div class="container">
        <div class="panel">
            <h2>Trade Operations</h2>
            
            <div class="input-group">
                <button class="button" onclick="getAllTrades()">Get All Trades</button>
            </div>
            
            <div class="input-group">
                <label for="tradeId">Trade ID:</label>
                <input type="text" id="tradeId" placeholder="Enter trade ID">
                <button class="button" onclick="getTradeById()">Get Trade by ID</button>
            </div>
            
            <div class="input-group">
                <label for="newTradeId">Trade ID:</label>
                <input type="text" id="newTradeId" placeholder="Trade ID">
            </div>
            <div class="input-group">
                <label for="party1">Party 1:</label>
                <input type="text" id="party1" placeholder="Party 1">
            </div>
            <div class="input-group">
                <label for="party2">Party 2:</label>
                <input type="text" id="party2" placeholder="Party 2">
            </div>
            <div class="input-group">
                <label for="amount">Amount:</label>
                <input type="text" id="amount" placeholder="Amount">
            </div>
            <div class="input-group">
                <label for="tradeType">Trade Type:</label>
                <input type="text" id="tradeType" placeholder="Trade Type">
            </div>
            <div class="input-group">
                <button class="button" onclick="createTrade()">Create Trade</button>
            </div>
            
            <div class="input-group">
                <button class="button" onclick="getTradeStatistics()">Get Statistics</button>
            </div>
            
            <div class="output" id="tradeOutput">Trade operations output will appear here...</div>
        </div>
        
        <div class="panel">
            <h2>AI Analysis</h2>
            
            <div class="input-group">
                <button class="button" onclick="analyzeTrades()">Analyze Trades</button>
            </div>
            
            <div class="input-group">
                <label for="aiTradeType">Trade Type for Recommendations:</label>
                <input type="text" id="aiTradeType" placeholder="Enter trade type">
                <button class="button" onclick="getRecommendations()">Get Recommendations</button>
            </div>
            
            <div class="input-group">
                <button class="button" onclick="predictTrends()">Predict Trends</button>
            </div>
            
            <div class="input-group">
                <button class="button" onclick="getInsights()">Get Combined Insights</button>
            </div>
            
            <div class="output" id="aiOutput">AI analysis output will appear here...</div>
        </div>
    </div>

    <script>
        let stompClient = null;
        let messageId = 0;

        function connect() {
            const socket = new SockJS('/mcp');
            stompClient = Stomp.over(socket);
            stompClient.connect({}, function (frame) {
                console.log('Connected: ' + frame);
                updateConnectionStatus(true);
                
                // Subscribe to trade responses
                stompClient.subscribe('/topic/trades', function (response) {
                    const message = JSON.parse(response.body);
                    document.getElementById('tradeOutput').textContent = JSON.stringify(message, null, 2);
                });
                
                // Subscribe to AI responses
                stompClient.subscribe('/topic/ai', function (response) {
                    const message = JSON.parse(response.body);
                    document.getElementById('aiOutput').textContent = JSON.stringify(message, null, 2);
                });
            });
        }

        function disconnect() {
            if (stompClient !== null) {
                stompClient.disconnect();
                updateConnectionStatus(false);
            }
        }

        function updateConnectionStatus(connected) {
            const status = document.getElementById('connectionStatus');
            if (connected) {
                status.textContent = 'Connected to MCP Server';
                status.className = 'status connected';
            } else {
                status.textContent = 'Disconnected';
                status.className = 'status disconnected';
            }
        }

        function sendMessage(destination, params) {
            if (stompClient && stompClient.connected) {
                const message = {
                    jsonrpc: "2.0",
                    id: (++messageId).toString(),
                    method: destination,
                    params: params
                };
                stompClient.send("/app" + destination, {}, JSON.stringify(message));
            } else {
                alert('Not connected to MCP server');
            }
        }

        function getAllTrades() {
            sendMessage('/trades/getAll', {});
        }

        function getTradeById() {
            const tradeId = document.getElementById('tradeId').value;
            if (tradeId) {
                sendMessage('/trades/getById', { tradeId: tradeId });
            } else {
                alert('Please enter a trade ID');
            }
        }

        function createTrade() {
            const tradeData = {
                tradeId: document.getElementById('newTradeId').value,
                party1: document.getElementById('party1').value,
                party2: document.getElementById('party2').value,
                amount: document.getElementById('amount').value,
                tradetype: document.getElementById('tradeType').value
            };
            sendMessage('/trades/create', { tradeData: tradeData });
        }

        function getTradeStatistics() {
            sendMessage('/trades/statistics', {});
        }

        function analyzeTrades() {
            sendMessage('/ai/analyze', {});
        }

        function getRecommendations() {
            const tradeType = document.getElementById('aiTradeType').value;
            sendMessage('/ai/recommendations', { tradeType: tradeType });
        }

        function predictTrends() {
            sendMessage('/ai/predict', {});
        }

        function getInsights() {
            sendMessage('/ai/insights', {});
        }

        // Connect on page load
        window.onload = function() {
            connect();
        };

        // Disconnect on page unload
        window.onbeforeunload = function() {
            disconnect();
        };
    </script>
</body>
</html>
